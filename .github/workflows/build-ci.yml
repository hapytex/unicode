name: CI/CD
on: push

jobs:
  linux1:
    name: Produce a .pdf.gz version for pages
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/master' || startsWith(github.ref, 'refs/tags/')
    steps:
    - uses: hapytex/github-actions/actions/setup-haskell@master
    - name: install requirements
      run: make install
    - name: checkout code
      uses: actions/checkout@v2.3.1
    - name: Build a .pdf file
      run: bash make.sh
    - name: Add cname to the directory
      uses: hapytex/github-actions/actions/add-cname-to-directory@master
      with:
        folder: "${{ steps.haddock.outputs.haddock-path }}"
        cname: "unicode.django-antipatterns.com"
    - name: deploy the .pdf.gz document
      uses: JamesIves/github-pages-deploy-action@4.0.0
      with:
        branch: gh-pages
        folder: 'out'
        single-commit: true
